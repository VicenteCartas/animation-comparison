import{E as k,O as T,a as D,s as Q,e as Y,A as Z,y as W,z as ee,k as te}from"./worker-CPQ97Tig.js";function he(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}function re(){return typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}class y{constructor(){this._xhr=re(),this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(y.CustomRequestHeaders).length>0||y.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const t in y.CustomRequestHeaders){const e=y.CustomRequestHeaders[t];e&&this._xhr.setRequestHeader(t,e)}}_shouldSkipRequestModifications(t){return y.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(t){this._xhr.onprogress=t}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(t){this._xhr.responseType=t}get timeout(){return this._xhr.timeout}set timeout(t){this._xhr.timeout=t}addEventListener(t,e,o){this._xhr.addEventListener(t,e,o)}removeEventListener(t,e,o){this._xhr.removeEventListener(t,e,o)}abort(){this._xhr.abort()}send(t){y.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)}open(t,e){for(const o of y.CustomRequestModifiers){if(this._shouldSkipRequestModifications(e))return;e=o(this._xhr,e)||e}e=e.replace("file:http:","http:"),e=e.replace("file:https:","https:"),this._requestURL=e,this._xhr.open(t,e,!0)}setRequestHeader(t,e){this._xhr.setRequestHeader(t,e)}getResponseHeader(t){return this._xhr.getResponseHeader(t)}}y.CustomRequestHeaders={};y.CustomRequestModifiers=new Array;y.SkipRequestModificationForBabylonCDN=!0;class C{}C.FilesToLoad={};class se{static ExponentialBackoff(t=3,e=500){return(o,i,a)=>i.status!==0||a>=t||o.indexOf("file:")!==-1?-1:Math.pow(2,a)*e}}class L extends Error{}L._setPrototypeOf=Object.setPrototypeOf||((r,t)=>(r.__proto__=t,r));const I={LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class E extends L{constructor(t,e,o){super(t),this.errorCode=e,this.innerError=o,this.name="RuntimeError",L._setPrototypeOf(this,E.prototype)}}const ne=r=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let e="",o,i,a,h,l,u,f,n=0;const s=ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);for(;n<s.length;)o=s[n++],i=n<s.length?s[n++]:Number.NaN,a=n<s.length?s[n++]:Number.NaN,h=o>>2,l=(o&3)<<4|i>>4,u=(i&15)<<2|a>>6,f=a&63,isNaN(i)?u=f=64:isNaN(a)&&(f=64),e+=t.charAt(h)+t.charAt(l)+t.charAt(u)+t.charAt(f);return e},M=r=>atob(r),ae=r=>{const t=M(r),e=t.length,o=new Uint8Array(new ArrayBuffer(e));for(let i=0;i<e;i++)o[i]=t.charCodeAt(i);return o.buffer},A=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class _ extends E{constructor(t,e){super(t,I.LoadFileError),this.name="LoadFileError",L._setPrototypeOf(this,_.prototype),e instanceof y?this.request=e:this.file=e}}class q extends E{constructor(t,e){super(t,I.RequestFileError),this.request=e,this.name="RequestFileError",L._setPrototypeOf(this,q.prototype)}}class j extends E{constructor(t,e){super(t,I.ReadFileError),this.file=e,this.name="ReadFileError",L._setPrototypeOf(this,j.prototype)}}const oe=r=>(r=r.replace(/#/gm,"%23"),r),g={DefaultRetryStrategy:se.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:r=>r,ScriptBaseUrl:"",ScriptPreprocessUrl:r=>r,CleanUrl:oe},N=(r,t)=>{if(!(r&&r.indexOf("data:")===0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||g.CorsBehavior instanceof String)t.crossOrigin=g.CorsBehavior;else{const e=g.CorsBehavior(r);e&&(t.crossOrigin=e)}},X=(r,t,e,o,i="",a,h=k.LastCreatedEngine)=>{if(typeof HTMLImageElement>"u"&&!h?._features.forceBitmapOverHTMLImageElement)return e("LoadImage is only supported in web or BabylonNative environments."),null;let l,u=!1;r instanceof ArrayBuffer||ArrayBuffer.isView(r)?typeof Blob<"u"&&typeof URL<"u"?(l=URL.createObjectURL(new Blob([r],{type:i})),u=!0):l=`data:${i};base64,`+ne(r):r instanceof Blob?(l=URL.createObjectURL(r),u=!0):(l=g.CleanUrl(r),l=g.PreprocessUrl(l));const f=c=>{if(e){const d=l||r.toString();e(`Error while trying to load image: ${d.indexOf("http")===0||d.length<=128?d:d.slice(0,128)+"..."}`,c)}};if(h?._features.forceBitmapOverHTMLImageElement)return B(l,c=>{h.createImageBitmap(new Blob([c],{type:i}),{premultiplyAlpha:"none",...a}).then(d=>{t(d),u&&URL.revokeObjectURL(l)}).catch(d=>{e&&e("Error while trying to load image: "+r,d)})},void 0,o||void 0,!0,(c,d)=>{f(d)}),null;const n=new Image;N(l,n);const s=[],x=()=>{for(const c of s)c.target.addEventListener(c.name,c.handler)},p=()=>{for(const c of s)c.target.removeEventListener(c.name,c.handler);s.length=0},O=()=>{p(),t(n),u&&n.src&&URL.revokeObjectURL(n.src)},b=c=>{p(),f(c),u&&n.src&&URL.revokeObjectURL(n.src)},w=c=>{if(c.blockedURI!==n.src||c.disposition==="report")return;p();const d=new Error(`CSP violation of policy ${c.effectiveDirective} ${c.blockedURI}. Current policy is ${c.originalPolicy}`);k.UseFallbackTexture=!1,f(d),u&&n.src&&URL.revokeObjectURL(n.src),n.src=""};s.push({target:n,name:"load",handler:O}),s.push({target:n,name:"error",handler:b}),s.push({target:document,name:"securitypolicyviolation",handler:w}),x();const U=l.substring(0,5)==="blob:",m=l.substring(0,5)==="data:",R=()=>{U||m||!y.IsCustomRequestAvailable?n.src=l:B(l,(c,d,H)=>{const P=!i&&H?H:i,J=new Blob([c],{type:P}),K=URL.createObjectURL(J);u=!0,n.src=K},void 0,o||void 0,!0,(c,d)=>{f(d)})},S=()=>{o&&o.loadImage(l,n)};if(!U&&!m&&o&&o.enableTexturesOffline)o.open(S,R);else{if(l.indexOf("file:")!==-1){const c=decodeURIComponent(l.substring(5).toLowerCase());if(C.FilesToLoad[c]&&typeof URL<"u"){try{let d;try{d=URL.createObjectURL(C.FilesToLoad[c])}catch{d=URL.createObjectURL(C.FilesToLoad[c])}n.src=d,u=!0}catch{n.src=""}return n}}R()}return n},F=(r,t,e,o,i)=>{const a=new FileReader,h={onCompleteObservable:new T,abort:()=>a.abort()};return a.onloadend=()=>h.onCompleteObservable.notifyObservers(h),i&&(a.onerror=()=>{i(new j(`Unable to read ${r.name}`,r))}),a.onload=l=>{t(l.target.result)},e&&(a.onprogress=e),o?a.readAsArrayBuffer(r):a.readAsText(r),h},B=(r,t,e,o,i,a,h)=>{if(r.name)return F(r,t,e,i,a?n=>{a(void 0,n)}:void 0);const l=r;if(l.indexOf("file:")!==-1){let n=decodeURIComponent(l.substring(5).toLowerCase());n.indexOf("./")===0&&(n=n.substring(2));const s=C.FilesToLoad[n];if(s)return F(s,t,e,i,a?x=>a(void 0,new _(x.message,x.file)):void 0)}const{match:u,type:f}=le(l);if(u){const n={onCompleteObservable:new T,abort:()=>()=>{}};try{const s=i?V(l):z(l);t(s,void 0,f)}catch(s){a?a(void 0,s):D.Error(s.message||"Failed to parse the Data URL")}return Q.SetImmediate(()=>{n.onCompleteObservable.notifyObservers(n)}),n}return $(l,(n,s)=>{t(n,s?.responseURL,s?.getResponseHeader("content-type"))},e,o,i,a?n=>{a(n.request,new _(n.message,n.request))}:void 0,h)},$=(r,t,e,o,i,a,h)=>{r=g.CleanUrl(r),r=g.PreprocessUrl(r);const l=g.BaseUrl+r;let u=!1;const f={onCompleteObservable:new T,abort:()=>u=!0},n=()=>{let s=new y,x=null,p;const O=()=>{s&&(e&&s.removeEventListener("progress",e),p&&s.removeEventListener("readystatechange",p),s.removeEventListener("loadend",b))};let b=()=>{O(),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear(),e=void 0,p=null,b=null,a=void 0,h=void 0,t=void 0};f.abort=()=>{u=!0,b&&b(),s&&s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),x!==null&&(clearTimeout(x),x=null),s=null};const w=m=>{const R=m.message||"Unknown error";a&&s?a(new q(R,s)):D.Error(R)},U=m=>{if(s){if(s.open("GET",l),h)try{h(s)}catch(R){w(R);return}i&&(s.responseType="arraybuffer"),e&&s.addEventListener("progress",e),b&&s.addEventListener("loadend",b),p=()=>{if(!(u||!s)&&s.readyState===(XMLHttpRequest.DONE||4)){if(p&&s.removeEventListener("readystatechange",p),s.status>=200&&s.status<300||s.status===0&&(!Y()||G())){const c=i?s.response:s.responseText;if(c!==null){try{t&&t(c,s)}catch(d){w(d)}return}}const R=g.DefaultRetryStrategy;if(R){const c=R(l,s,m);if(c!==-1){O(),s=new y,x=setTimeout(()=>U(m+1),c);return}}const S=new q("Error status: "+s.status+" "+s.statusText+" - Unable to load "+l,s);a&&a(S)}},s.addEventListener("readystatechange",p),s.send()}};U(0)};if(o&&o.enableSceneOffline){const s=p=>{p&&p.status>400?a&&a(p):n()},x=()=>{o&&o.loadFile(g.BaseUrl+r,p=>{!u&&t&&t(p),f.onCompleteObservable.notifyObservers(f)},e?p=>{!u&&e&&e(p)}:void 0,s,i)};o.open(x,s)}else n();return f},G=()=>typeof location<"u"&&location.protocol==="file:",ie=r=>A.test(r),le=r=>{const t=A.exec(r);return t===null||t.length===0?{match:!1,type:""}:{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function V(r){return ae(r.split(",")[1])}const z=r=>M(r.split(",")[1]),ce=()=>{Z._FileToolsLoadImage=X,W.loadFile=B,ee.loadFile=B};ce();let v;const ue=(r,t,e,o,i,a,h,l,u,f)=>{v={DecodeBase64UrlToBinary:r,DecodeBase64UrlToString:t,DefaultRetryStrategy:e.DefaultRetryStrategy,BaseUrl:e.BaseUrl,CorsBehavior:e.CorsBehavior,PreprocessUrl:e.PreprocessUrl,IsBase64DataUrl:o,IsFileURL:i,LoadFile:a,LoadImage:h,ReadFile:l,RequestFile:u,SetCorsBehavior:f},Object.defineProperty(v,"DefaultRetryStrategy",{get:function(){return e.DefaultRetryStrategy},set:function(n){e.DefaultRetryStrategy=n}}),Object.defineProperty(v,"BaseUrl",{get:function(){return e.BaseUrl},set:function(n){e.BaseUrl=n}}),Object.defineProperty(v,"PreprocessUrl",{get:function(){return e.PreprocessUrl},set:function(n){e.PreprocessUrl=n}}),Object.defineProperty(v,"CorsBehavior",{get:function(){return e.CorsBehavior},set:function(n){e.CorsBehavior=n}})};ue(V,z,g,ie,G,B,X,F,$,N);class de{static Instantiate(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];const e=te(t);if(e)return e;D.Warn(t+" not found, you may have missed an import.");const o=t.split(".");let i=window||this;for(let a=0,h=o.length;a<h;a++)i=i[o[a]];return typeof i!="function"?null:i}}de.RegisteredExternalClasses={};export{V as D,ne as E,g as F,de as I,B as L,$ as R,N as S,y as W,F as a,he as b,X as c,ie as d};
